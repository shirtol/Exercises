const carMarket = {
    sellers: [
        {
            agencyName: "Best Deal",
            cash: 1245000,
            credit: 200000,
            agencyId: "Plyq5M5AZ",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "3",
                            year: 2015,
                            price: 13,
                            carNumber: "AZJZ4",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "X6",
                            year: 2020,
                            price: 966500,
                            carNumber: "S6DL1",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Land Cruiser",
                            year: 2020,
                            price: 336300,
                            carNumber: "6rvXw",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Hilux",
                            year: 2005,
                            price: 35005,
                            carNumber: "MWXBG",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Corolla",
                            year: 2020,
                            price: 111900,
                            carNumber: "hCzl-",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "Focus",
                            year: 2020,
                            price: 98200,
                            carNumber: "kN3HP",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Focus",
                            year: 2005,
                            price: 6502,
                            carNumber: "LJTCs",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Alpha romeo",
                    models: [
                        {
                            name: "Romeo Julia",
                            year: 2020,
                            price: 275406,
                            carNumber: "2kjy7",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Romeo Stelvio",
                            year: 2019,
                            price: 215403,
                            carNumber: "7A5b-",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Traverse",
                            year: 2020,
                            price: 201102,
                            carNumber: "QwBOT",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Impala",
                            year: 2019,
                            price: 165041,
                            carNumber: "2v4jt",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Malibu",
                            year: 2017,
                            price: 75405,
                            carNumber: "O4_Jv",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "CarMax",
            cash: 968541,
            credit: 500000,
            agencyId: "26_IPfHU1",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "X5",
                            year: 2015,
                            price: 218000,
                            carNumber: "4Ixb0",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "X6",
                            year: 2014,
                            price: 97100,
                            carNumber: "kAnv-",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Z4",
                            year: 2019,
                            price: 296900,
                            carNumber: "ISMdU",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "3",
                            year: 2010,
                            price: 75100,
                            carNumber: "9DJPw",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Land Cruiser",
                            year: 2005,
                            price: 80540,
                            carNumber: "Kt-pW",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Corolla",
                            year: 2019,
                            price: 109100,
                            carNumber: "YiYdI",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Hilux",
                            year: 2019,
                            price: 204000,
                            carNumber: "DRmNw",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "F250",
                            year: 2020,
                            price: 198500,
                            carNumber: "g4Wfp",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Explorer",
                            year: 2020,
                            price: 265200,
                            carNumber: "iNT8Q",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Alpha romeo",
                    models: [
                        {
                            name: "Spider",
                            year: 2011,
                            price: 75405,
                            carNumber: "6t7QU",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "166",
                            year: 2002,
                            price: 12400,
                            carNumber: "XMqpn",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Impala",
                            year: 2016,
                            price: 65042,
                            carNumber: "vbeAo",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Savannah",
                            year: 2016,
                            price: 76505,
                            carNumber: "WelWa",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "The Auto World",
            cash: 687450,
            credit: 200000,
            agencyId: "gNHjNFL12",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "X6",
                            year: 2018,
                            price: 548100,
                            carNumber: "EMW_7",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "3",
                            year: 2017,
                            price: 178000,
                            carNumber: "XlnB4",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2017,
                            price: 101542,
                            carNumber: "-RQgN",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Highlander",
                            year: 2017,
                            price: 202540,
                            carNumber: "AZJZ4",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Corolla",
                            year: 1996,
                            price: 5420,
                            carNumber: "kHE8f",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Corolla",
                            year: 2012,
                            price: 40570,
                            carNumber: "p2qEi",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "Explorer",
                            year: 2014,
                            price: 127502,
                            carNumber: "Ty1zN",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "F350",
                            year: 2012,
                            price: 54250,
                            carNumber: "z03H2",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Savannah",
                            year: 2010,
                            price: 36504,
                            carNumber: "RXFZe",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Malibu",
                            year: 2009,
                            price: 19585,
                            carNumber: "K5IsM",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "Car Werks",
            cash: 302502,
            credit: 150000,
            agencyId: "9KeaYbRLP",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "8",
                            year: 2020,
                            price: 942500,
                            carNumber: "4IUMz",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "X6",
                            year: 2010,
                            price: 129000,
                            carNumber: "Vw0fV",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "X3",
                            year: 2019,
                            price: 358100,
                            carNumber: "ufN54",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "3",
                            year: 2020,
                            price: 389100,
                            carNumber: "F127X",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "3",
                            year: 2002,
                            price: 18400,
                            carNumber: "ueZUp",
                            ownerId: "9KeaYbRLP",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2011,
                            price: 38520,
                            carNumber: "AZJZ4",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "Land Cruiser",
                            year: 2019,
                            price: 290040,
                            carNumber: "AZJZ4",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "Hilux",
                            year: 2020,
                            price: 215700,
                            carNumber: "xig8N",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "Hilux",
                            year: 2015,
                            price: 178506,
                            carNumber: "ghTiQ",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "Corolla",
                            year: 2002,
                            price: 8504,
                            carNumber: "Mvw8T",
                            ownerId: "9KeaYbRLP",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Impala",
                            year: 2005,
                            price: 9320,
                            carNumber: "BZpkt",
                            ownerId: "9KeaYbRLP",
                        },
                        {
                            name: "Malibu",
                            year: 2002,
                            price: 4502,
                            carNumber: "KqKV_",
                            ownerId: "9KeaYbRLP",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "Carsova",
            cash: 72450,
            credit: 50000,
            agencyId: "oqQmsZoUo",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "7",
                            year: 1999,
                            price: 24700,
                            carNumber: "sZrjp",
                            ownerId: "oqQmsZoUo",
                        },
                        {
                            name: "3",
                            year: 2008,
                            price: 54000,
                            carNumber: "da88K",
                            ownerId: "oqQmsZoUo",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2019,
                            price: 124050,
                            carNumber: "ZfbqH",
                            ownerId: "oqQmsZoUo",
                        },
                        {
                            name: "Hilux",
                            year: 1996,
                            price: 11540,
                            carNumber: "AZJZ4",
                            ownerId: "oqQmsZoUo",
                        },
                    ],
                },
            ],
        },
    ],
    customers: [
        {
            name: "Lilah Goulding",
            id: "BGzHhjnE8",
            cars: [
                {
                    name: "Corolla",
                    year: 2013,
                    price: 40570,
                    carNumber: "16da1",
                    ownerId: "BGzHhjnE8",
                },
            ],
            cash: 35000,
        },
        {
            name: "Ravi Murillo",
            id: "2RprZ1dbL",
            cars: [
                {
                    name: "M5",
                    year: 2019,
                    price: 578054,
                    carNumber: "WIh0U",
                    ownerId: "2RprZ1dbL",
                },
                {
                    name: "Spider",
                    year: 2012,
                    price: 81520,
                    carNumber: "RLS4q",
                    ownerId: "2RprZ1dbL",
                },
            ],
            cash: 278542,
        },
        {
            name: "Aleksander Carr",
            id: "pAuFtn_WA",
            cars: [
                {
                    name: "Highlander",
                    year: 2018,
                    price: 214503,
                    carNumber: "2WU_y",
                    ownerId: "pAuFtn_WA",
                },
            ],
            cash: 125402,
        },
        {
            name: "Lana Edge",
            id: "cnTobUDy6",
            cars: [
                {
                    name: "F250",
                    year: 2020,
                    price: 198500,
                    carNumber: "Xxcy_",
                    ownerId: "cnTobUDy6",
                },
                {
                    name: "Hilux",
                    year: 2005,
                    price: 35005,
                    carNumber: "VSCUj",
                    ownerId: "cnTobUDy6",
                },
            ],
            cash: 7000,
        },
        {
            name: "Nikita Philip",
            id: "5x2tMcX4R",
            cars: [
                {
                    name: "Impala",
                    year: 2016,
                    price: 65042,
                    carNumber: "LKInp",
                    ownerId: "5x2tMcX4R",
                },
            ],
            cash: 40541,
        },
        {
            name: "Bob Steel",
            id: "Wm6BkA1F0",
            cars: [],
            cash: 15732,
        },
        {
            name: "Will Reyes",
            id: "FQvNsEwLZ",
            cars: [
                { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
                {
                    name: "Land Cruiser",
                    year: 2020,
                    price: 336300,
                    carNumber: "vaJvd",
                    ownerId: "FQvNsEwLZ",
                },
                {
                    name: "Romeo Julia",
                    year: 2020,
                    price: 275406,
                    carNumber: "qLoYR",
                    ownerId: "FQvNsEwLZ",
                },
                {
                    name: "Explorer",
                    year: 2020,
                    price: 265200,
                    carNumber: "tlGRq",
                    ownerId: "FQvNsEwLZ",
                },
            ],
            cash: 1547242,
        },
    ],
    taxesAuthority: {
        totalTaxesPaid: 0,
        sumOfAllTransactions: 0,
        numberOfTransactions: 0,
    },
};

//?--------------------------------------------------------------------
/*TODO: Add another parameter to each method, the parameter
should be the thing we are working on (like carMarket)*/

//! agency's func's
//todo getters

//!--------------------------------------------------------------------

//* getAgencyByName
//? @param {string} - name
//? @return {Object} - agency object

carMarket.getAgencyByName = function (name) {
    for (const agency of carMarket.sellers) {
        if (agency.agencyName === name) {
            return agency;
        }
    }
    return "This agency name is not found in this market.";
};

carMarket.getAgencyByName2 = function (name) {
    return carMarket.sellers.filter((seller) => seller.agencyName === name);
};

// console.log(carMarket.getAgencyByName("Best Deal"));
// console.log(carMarket.getAgencyByName("Best"));
// console.log(carMarket.getAgencyByName("CarMax"));

// console.log(carMarket.getAgencyByName2("CarMax"));

//!--------------------------------------------------------------------

//* getAgencyIdByName
//? @param {String} - name
//? @return {String} - agencyId

carMarket.getAgencyIdByName = function (name) {
    const agencyId = carMarket.getAgencyByName(name).agencyId;
    if (agencyId === undefined) {
        return "This agency doesn't exist";
    }
    return agencyId;
};

// console.log(carMarket.getAgencyIdByName("Best Deal"));
// console.log(carMarket.getAgencyIdByName("Best"));
// console.log(carMarket.getAgencyIdByName("CarMax"));

//!--------------------------------------------------------------------

//* getAllAgenciesName
//? @param {}
//? @return {string[]} - agenciesNameArr - Array of all agencies name

carMarket.getAllAgenciesName = function () {
    const agenciesNameArr = [];
    for (const agency of carMarket.sellers) {
        agenciesNameArr.push(agency.agencyName);
    }
    return agenciesNameArr;
};

// console.log(carMarket.getAllAgenciesName());

//!--------------------------------------------------------------------

//* getAllCarToBuy
//? @param {}
//? @return {object[]} - allCarsToBuy - arrays of all cars objects

carMarket.getAllCarToBuy = function () {
    const allCarsToBuy = [];
    for (const agency of carMarket.sellers) {
        for (const car of agency.cars) {
            allCarsToBuy.push(car);
        }
    }
    return allCarsToBuy;
};

// console.log(carMarket.getAllCarToBuy());

//!--------------------------------------------------------------------

//* getAllCarToBuyByAgencyId
//? @param {string} - id of agency
//? @return {object[]} - carsArray - arrays of all models objects of specific agency

carMarket.getAllCarToBuyByAgencyId = function (agencyId) {
    const carsArray = [];
    let agency;
    for (const seller of carMarket.sellers) {
        if (seller.agencyId === agencyId) {
            agency = seller;
        }
    }
    for (const car of agency.cars) {
        for (const model of car.models) {
            carsArray.push(model);
        }
    }
    console.log(carsArray.length);
    return carsArray;
};

// console.log(carMarket.getAllCarToBuyByAgencyId("Plyq5M5AZ"));

//!--------------------------------------------------------------------

//* getAllBrandsToBuyAgencyId
//? @param {string} - agencyId -  id of agency
// ? @return {string[]} - arrOfBrands - arrays of all brands name in specific agency

carMarket.getAllBrandsToBuyAgencyId = function (agencyId) {
    const arrOfBrands = [];
    let agency;
    for (const seller of carMarket.sellers) {
        if (seller.agencyId === agencyId) {
            agency = seller;
        }
    }
    for (const car of agency.cars) {
        arrOfBrands.push(car.brand);
    }
    return arrOfBrands;
};

// console.log(carMarket.getAllBrandsToBuyAgencyId("Plyq5M5AZ"));

//!--------------------------------------------------------------------

//! customer func's
//todo getters

//!--------------------------------------------------------------------

//* getCustomerByName
//? @param {string} - name
//? @return {Object} - customer

carMarket.getCustomerByName = function (name) {
    for (const customer of carMarket.customers) {
        if (customer.name === name) {
            return customer;
        }
    }
    return "This customer is not found.";
};

// console.log(carMarket.getCustomerByName("Lilah Goulding"));
// console.log(carMarket.getCustomerByName("Lilah Goulb"));

//!--------------------------------------------------------------------

//* getCustomerIdByName
//? @param {name}
//? @return {String} - customerId - The customer id

carMarket.getCustomerIdByName = function (name) {
    const customerId = carMarket.getCustomerByName(name).id;
    if (customerId === undefined) {
        return "This customer doesn't exist";
    }
    return customerId;
};

// console.log(carMarket.getCustomerIdByName("Lilah Goulding"));
// console.log(carMarket.getCustomerIdByName("Lilah Goulb"));

//!--------------------------------------------------------------------

//* getAllCustomersNames
//? @param {}
//? @return {string[]} - customersNameArr -  Array of all customers name

carMarket.getAllCustomersNames = function () {
    const customersNameArr = [];
    for (const customer of carMarket.customers) {
        customersNameArr.push(customer.name);
    }
    return customersNameArr;
};

// console.log(carMarket.getAllCustomersNames());

//!--------------------------------------------------------------------

//* getAllCustomerCars
//? @param {id} - costumerId - costumer id
//? @return {object[]} - customerCarsArr -  Array of all customer cars object

carMarket.getAllCustomerCars = function (costumerId) {
    let costumer;
    for (const person of carMarket.customers) {
        if (person.id === costumerId) {
            costumer = person;
        }
    }
    if (costumer === undefined) {
        return "This customer doesn't exist";
    }
    return costumer.cars;
};

// console.log(carMarket.getAllCustomerCars("cnTobUDy6"));
// console.log(carMarket.getAllCustomerCars("cnTobUD"));

//!--------------------------------------------------------------------

//* getCustomerCash
//? @param {id} - costumerId - costumer id
//? @return {number} - CustomerCash

carMarket.getCustomerCash = function (costumerId) {
    let costumer;
    for (const person of carMarket.customers) {
        if (person.id === costumerId) {
            costumer = person;
        }
    }
    if (costumer === undefined) {
        return "This customer doesn't exist";
    }
    return costumer.cash;
};

// console.log(carMarket.getCustomerCash("cnTobUDy6"));
// console.log(carMarket.getCustomerCash("cnTobUD"));

//!------------------------------------------------------------
//*  1) setPropertyBrandToAllCars
//? set all cars model object the current brand
//? @param {}
//? @return {}

carMarket.getBrandByCarName = function (carName) {
    for (const seller of carMarket.sellers) {
        for (const car of seller.cars) {
            for (const model of car.models) {
                if (model.name === carName) {
                    return car.brand;
                }
            }
        }
    }
    return null;
};

carMarket.setPropertyBrandToAllCars = function () {
    for (const seller of carMarket.sellers) {
        for (const car of seller.cars) {
            const brand = car.brand;
            for (const model of car.models) {
                model["brand"] = brand;
            }
        }
    }
    for (const customer of carMarket.customers) {
        for (const car of customer.cars) {
            car["brand"] = carMarket.getBrandByCarName(car.name);
        }
    }
    // console.log(carMarket.sellers[0].cars[1].models);
    // console.log(carMarket.customers[0].cars[0]);
};

carMarket.setPropertyBrandToAllCars();

//todo Agency setters

//!------------------------------------------------------------

//* setNewCarToAgency
//? @param {string} - id of agency
//? @param {object} - carObject
//? @return {}

carMarket.setNewCarToAgency = function (agencyId, carObject) {
    const currAgency = carMarket.sellers.find(
        (seller) => seller.agencyId === agencyId
    );
    if (!currAgency) {
        return "This agency is not found in this market.";
    }
    currAgency.cars.push(carObject);
};

carMarket.setNewCarToAgency("Plyq5M5AZ", { brand: "toledano", models: [] });
// console.log(carMarket.sellers[0].cars);

//!------------------------------------------------------------

//* deleteCarFromAgency
//? @param {string} - id of agency
//? @param {string} -  Car id
// ? @return {}
// Assumption: Car id is carNumber, so one car model will be deleted.

carMarket.deleteCarFromAgency = function (agencyId, carId) {
    const agency = carMarket.sellers.find(
        (seller) => seller.agencyId === agencyId
    );

    if (!agency) return null;

    for (const car of agency.cars) {
        let modelIdx;
        for (const model of car.models) {
            if (carId === model.carNumber) {
                modelIdx = car.models.indexOf(model);
            }
        }
        car.models.splice(modelIdx, 1);
    }
};

// carMarket.deleteCarFromAgency("Plyq5M5AZ", "S6DL1");
// console.log(carMarket.sellers[0].cars[0].models);

//!------------------------------------------------------------

//* decrementOrIncrementCashOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCashOfAgency = function (agencyId, amount) {
    const agency = carMarket.sellers.find(
        (seller) => seller.agencyId === agencyId
    );

    if (!agency) return null;
    const currAgencyCash = agency.cash + amount;
    if (currAgencyCash < 0) {
        return null;
    }
    agency.cash = currAgencyCash;
    return currAgencyCash;
};
// console.log(carMarket.decrementOrIncrementCashOfAgency("Plyq5M5AZ", 5000));
// console.log(carMarket.decrementOrIncrementCashOfAgency("Plyq5M5AZ", -10000));

//* decrementOrIncrementCreditOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCreditOfAgency = function (agencyId, amount) {
    const agency = carMarket.sellers.find(
        (seller) => seller.agencyId === agencyId
    );

    if (!agency) return null;

    const currAgencyCredit = agency.credit + amount;
    if (currAgencyCredit < 0) {
        return null;
    }
    agency.credit = currAgencyCredit;
    return currAgencyCredit;
};

// console.log(carMarket.decrementOrIncrementCreditOfAgency("Plyq5M5AZ", 5000));
// console.log(carMarket.decrementOrIncrementCreditOfAgency("Plyq5M5AZ", -10000));
// console.log(carMarket.decrementOrIncrementCreditOfAgency("Plyq5M5AZ", -200000));

//* setAmountOfCarsToBuyToAllAgency's
//? set a new property amountOfCars to all agency's, that represent the amount of cars available in the agency.
//? @param {}
// ? @return {objects[]} - sellers - array of all agency's

carMarket.setAmountOfCarsToBuyToAllAgency = function () {
    for (const seller of carMarket.sellers) {
        let carCount = 0;
        for (const car of seller.cars) {
            for (const model of car.models) {
                carCount++;
            }
        }
        seller["amountOfCars"] = carCount;
    }
    return carMarket.sellers;
};

// console.log(carMarket.setAmountOfCarsToBuyToAllAgency());

//todo setters

//* setCarToCostumer
//? @param {string} - costumerId
//? @param {object} - carObject
//? @return {object[]} - allCarsOfCostumer

carMarket.setCarToCustomer = function (customerId, carObject) {
    const customer = carMarket.customers.find(
        (person) => person.id === customerId
    );

    if (!customer) return null;
    customer.cars.push(carObject);
    return customer.cars;
};

// console.log(
//     carMarket.setCarToCustomer("BGzHhjnE8", {
//         name: "picanto",
//         year: 2020,
//         price: 80000,
//         carNumber: "111111",
//         ownerId: "BGzHhjnE8",
//     })
// );

//* deleteCarOfCostumer
//? @param {string} - costumerId
//? @param {string} - carId
//? @return {object[]} - allCarsOfCostumer

carMarket.deleteCarOfCostumer = function (customerId, carId) {
    const customer = carMarket.customers.find(
        (person) => person.id === customerId
    );

    if (!customer) return null;

    const carToDelete = customer.cars.find((car) => car.carNumber === carId);

    if (!carToDelete) return null;

    const carIdx = customer.cars.indexOf(carToDelete);
    customer.cars.splice(carIdx, 1);
    return customer.cars;
};

// console.log(carMarket.deleteCarOfCostumer("2RprZ1dbL", "WIh0U"));

//* decrementOrIncrementCashOfCostumer
//? @param {string} - costumerId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - costumerCash

carMarket.decrementOrIncrementCashOfCustomer = function (customerId, amount) {
    const customer = carMarket.customers.find(
        (person) => person.id === customerId
    );

    if (!customer) return null;

    const currCustomerCash = customer.cash + amount;
    if (currCustomerCash < 0) {
        return null;
    }
    customer.cash = currCustomerCash;
    return currCustomerCash;
};
// console.log(carMarket.decrementOrIncrementCashOfCustomer("2RprZ1dbL", 1000));
// console.log(carMarket.decrementOrIncrementCashOfCustomer("2RprZ1dbL", -2000));

//! -------------------------------------------------------
//* 2) sortAndFilterByYearOfProduction
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by year of production.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

// Assumption: the value of fromYear (including) and toYear (excluding).

carMarket.sortAndFilterByYearOfProduction = function (
    arrOfCars,
    fromYear,
    toYear,
    isAscendingOrder
) {
    const filteredArr = arrOfCars.filter(
        (car) => car.year >= fromYear && car.year <= toYear
    );

    filteredArr.sort((car1, car2) =>
        isAscendingOrder ? car1.year - car2.year : car2.year - car1.year
    );

    return filteredArr;
};

// console.log(
//     carMarket.sortAndFilterByYearOfProduction(
//         carMarket.customers[1].cars,
//         2010,
//         2020,
//         true
//     )
// );
// console.log(
//     carMarket.sortAndFilterByYearOfProduction(
//         carMarket.customers[1].cars,
//         2010,
//         2020,
//         false
//     )
// );
// console.log(
//     carMarket.sortAndFilterByYearOfProduction(
//         carMarket.customers[1].cars,
//         2010,
//         2013,
//         false
//     )
// );

//* 3) sortAndFilterByPrice
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by price of the cars.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

// Assumption: the value of fromYear (including) and toYear (excluding).

carMarket.sortAndFilterByPrice = function (
    arrOfCars,
    fromPrice,
    toPrice,
    isAscendingOrder
) {
    const filteredArr = arrOfCars.filter(
        (car) => car.price >= fromPrice && car.price <= toPrice
    );

    filteredArr.sort((car1, car2) =>
        isAscendingOrder ? car1.price - car2.price : car2.price - car1.price
    );

    return filteredArr;
};

// console.log(
//     carMarket.sortAndFilterByPrice(
//         carMarket.customers[1].cars,
//         10,
//         1000000,
//         true
//     )
// );
// console.log(
//     carMarket.sortAndFilterByPrice(
//         carMarket.customers[1].cars,
//         10,
//         1000000,
//         false
//     )
// );
// console.log(
//     carMarket.sortAndFilterByPrice(
//         carMarket.customers[1].cars,
//         570000,
//         600000,
//         false
//     )
// );

//* 4 ) searchCar
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   optional @param {string} - brand - Look only for cars of this brand

carMarket.searchCar = function (
    arrOfCars,
    fromYear,
    toYear,
    fromPrice,
    toPrice,
    brand
) {
    return arrOfCars
        .filter((car) => car.price >= fromPrice && car.price <= toPrice)
        .filter((car) => car.year >= fromYear && car.year <= toYear)
        .filter((car) => (brand ? car.brand === brand : true));
};

// console.log(
//     carMarket.searchCar(carMarket.customers[6].cars, 2020, 2020, 260000, 300000)
// );
// console.log(
//     carMarket.searchCar(carMarket.customers[6].cars, 2019, 2019, 260000, 300000)
// );

//* 5 ) sellCar
//?   Sell ​​a car to a specific customer
//?   @param {string} - agencyId
//?   @param {string} - customerId
//?   @param {string} - carModel
//?   @return {object} - The object of the car purchased by the customer or an explanation message
// *    - 5a. Subtract the vehicle amount + 17% (tax) from the customer's cash.
// *     - 5b. Add the vehicle value to the car agency cash.
// *     - 5c. Change the car owner's id to the customer's id.
// *     - 5d. Remove the car from the array of the agency's car models.
// *     - 5e. Add the car to the client cars array.
// *
// *     Taxes Authority:
// *     - 5f. Pay 17 percent of the vehicle value to the tax authority. (add the amount to totalTaxesPaid)
// *     - 5g. Increase the number of transactions made in one (numberOfTransactions)
// *     - 5h. Add the vehicle amount + tax to sumOfAllTransactions
// !     - Check that there is the requested vehicle at the agency in not return 'The vehicle does not exist at the agency'
// !     - Check that the customer has enough money to purchase the vehicle, if not return 'The customer does not have enough money'

//!      - Try to divide the tasks into several functions and try to maintain a readable language.

const getAgencyById = function (agencyId) {
    const agency = carMarket.sellers.find(
        (agency) => agency.agencyId === agencyId
    );

    if (!agency) return null;
    return agency;
};

const getCustomerById = function (customerId) {
    const customer = carMarket.customers.find(
        (person) => person.id === customerId
    );

    if (!customer) return null;
    return customer;
};

const subtractCarPriceFromCustomerCash = function (customer, price) {
    customer.cash -= 1.17 * price;
    return customer.cash;
};

const checkIfCarIsInAgency = function (agency, carModel) {
    return agency.cars.find((car) => car.models.includes(carModel))
        ? true
        : false;
};

const doesCustomerHasEnoughCash = function (customer, price) {
    return customer.cash - 1.17 * price >= 0;
};

const handleSaleFromAgency = function (agency, carModel) {
    agency.cash += carModel.price;
    carMarket.deleteCarFromAgency(agency.agencyId, carModel.carNumber);
};

const handleSaleToCustomer = function (customer, carModel) {
    subtractCarPriceFromCustomerCash(customer, carModel.price);
    carModel.ownerId = customer.id;
    carMarket.setCarToCustomer(customer.id, carModel);
};

const handleSaleTax = function (carModel) {
    carMarket.taxesAuthority.totalTaxesPaid += 0.17 * carModel.price;
    carMarket.taxesAuthority.numberOfTransactions++;
    carMarket.taxesAuthority.sumOfAllTransactions += 1.17 * carModel.price;
};

carMarket.sellCar = function (agencyId, customerId, carModel) {
    const agency = getAgencyById(agencyId);
    const customer = getCustomerById(customerId);
    if (!checkIfCarIsInAgency(agency, carModel))
        return "The vehicle does not exist at the agency";

    if (!doesCustomerHasEnoughCash(customer, carModel.price))
        return "The customer does not have enough money";

    handleSaleFromAgency(agency, carModel);
    handleSaleToCustomer(customer, carModel);
    handleSaleTax(carModel);
    return carModel;
};

console.log(
    carMarket.sellCar(
        "Plyq5M5AZ",
        "BGzHhjnE8",
        carMarket.sellers[0].cars[0].models[0]
    )
);
